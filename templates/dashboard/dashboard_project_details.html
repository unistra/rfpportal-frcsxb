{% extends 'dashboard/dashboard.html' %}

{% block title %} {{ project.name }} - Details {% endblock %}

{% block dashboard_nav %}
    {% include 'dashboard/dashboard_navigation_pane.html' %}
{% endblock %}

{% block dashboard_action %}

<!-- Project Details -->
<div class="row" id="project_detail">

    <div class="col-xs-12 col-md-12">

    <h3>{{ project.name }}</h3>
    <h4>PI: <strong>{{ project.user.get_full_name }}</strong></h4>
    <h4>Category: <strong>{{ project.rfp }}</strong></h4>
    <hr>
    {% for p in project_data %}
        {% if p.label == '' %}
           <p class="project_data hide" id=""><strong>{{ p.label }} </strong>{{ p.data|linebreaksbr }}</p>

           {% elif p.name == 'document' %}

           <div class = "col-xs-12 col-md-4">

               <p class="file_field"><strong>Document: </strong></p>
           </div>

           <div class = col-md-8>
              <p>{% if project.document %}<a href="{{ project.document.url }}" target="_blank"> {{ project.document.name }} </a> {% endif %}</p>
           </div>
           {% else %}

           <p class="project_data" id="{{ p.label|slugify }}"><strong>{{ p.label }} </strong>{{ p.data|linebreaksbr }}</p>
        {% endif %}

    {% endfor %}

        </div>
</div>

<!--Budget-->
{% block budget_summary %}
    {% include 'rfp/project/project_budget.html' %}
{% endblock %}

<!--Reviewer-->
{% block reviewer_summary %}
    {% if project.rfp.add_reviewer %}
{% load user_extras %}
<!--Reviewer Detail-->
<div class="row " id="reviewer_detail">
            <div class="col-xs-12 col-md-12">
            <h3>Proposed Reviewer
            </h3>

               <table class="table table-striped">


                        <tr>
                            <th>Contact</th>
                            <th>Email</th>
                            <th>City</th>
                            <th>Type</th>
                            <th></th>
                            <th>Actions</th>

                        </tr>


                    <tbody>
                    {% for r in prop_rev_list %}

                            <tr>
                                <td>{{ r }}</td>
                                <td>{{ r.email }}</td>
                                <td>{{ r.city }}</td>
                                <td>{{ r.type }}</td>
                                <td>{% if user|is_pi %}<a  href = "{% url 'edit_reviewer' r.pk %}?redirect={{ current_url }}">Edit</a> {% endif %}</td>
                                <td>{% if user.is_staff %} <a href="{% url 'dashboard_invite_reviewer' r.id %}">Send Invitation</a> {% endif %}
                                </td>
                            </tr>

                    {% endfor %}
                    </tbody>
                </table>
                {% if user|is_pi %}
                <p>
                <a href="{% url 'add_unique_reviewer' project.pk %}?redirect={{ current_url }}">
                Propose another reviewer
                </a>

            </p>{% endif %}
            </div>

    <div class="col-xs-12 col-md-12">
    <h3>Excluded Reviewer</h3>
            <table class="table">

                <thead>
                        <tr>

                            <th>Contact</th>
                            <th>Institution</th>
                            <th>Type</th>
                            <th></th>

                        </tr>
                    </thead>

                    <tbody>
                    {% for r in excluded_rev_list %}

                    <tr>

                        <td>{{ r.first_name }} {{ r.last_name }}</td>
                        <td>{{ r.institution }}</td>
                        <td>{{ r.type }}</td>
                        <td>{% if user|is_pi %}<a href = "{% url 'edit_excluded_reviewer' r.pk %}?redirect={{ current_url }}">Edit</a> {% endif %}</td>

                    </tr>

                    {% endfor %}
                    </tbody>
                </table>
                {% if user|is_pi %}<p>
                <a href="{% url 'exclude_unique_reviewer' project.pk %}?redirect={{ current_url }}">
                Exclude another reviewer
                </a></p>{% endif %}

    {% block project_next %} {% endblock %}

    </div>
</div>

{% endif %}
{% endblock %}

<!--List of Reviews-->
<div class="row">
    <div class="col-xs-12 col-md-12">
        <h3>Reviews</h3>

        <table class="table table-striped">
            <tr>
                <th>Reviewer</th>
                <th>Review</th>
                <th>Date</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>

{% for review in list_of_review %}
            <tr>
                <td><a href="{% url 'dashboard_reviewer_detail' review.user.id %}">{{ review.user.get_full_name }}</a></td>
                <td>
                    <a href="{% url 'view_review' review.id %}" target="_blank">{{ review.custom_0|truncatewords:15 }}</a>
                </td>
                <td>{{ review.date }}</td>
                <td>{{ review.status }}</td>
                <td><a href="{% url 'dashboard_follow_up_with_reviewer' review.id %}">Follow up</a></td>
            </tr>

{% empty %}

    <p><em>Sorry no reviews has been submitted yet.</em></p>

{% endfor %}

</table>
</div>
</div>

<script>
    $('#project-title').hide();
</script>

<script>
     $("#tableId").dataTable();
</script>

{% endblock %}
