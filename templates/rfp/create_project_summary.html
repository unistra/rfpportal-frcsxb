{% extends 'base.html' %}
{% load user_extras %}

{% block title %}Edit {{ project.name }} {% endblock %}

{% block body_block %}
<div class="container">
<!--Project Header-->
{% include 'rfp/project/project_header.html' %}

<!--
<div class="alert alert-success" role="alert">
    <p style="text-align:center">
        Your project has been succesfully submitted.
        You will recieve a confirmation email soon at this address: {{ user.email }}.
        Click <a href="#" onclick="window.print();return false;">here</a> to print this page.
    </p>
</div>

<div class="alert alert-info" role="alert">
    <p style="text-align:center">You can edit your project until the deadline.</p>
</div>
-->

<div class="col-xs-12 col-md-12">
    {%  if project.status == 'submitted' %}
        <div class="alert alert-success">
            <p>Your project has been succesfully submitted. Click <a href="#" onClick="window.print()">here</a> to print.</p>
        </div>
    {% else %}
        <div class="alert alert-warning">
            <p> Your project has not been yet submitted. Please review the information and click
                <a href="#" data-toggle="modal" data-target="#myModal"> here to submit</a> your Project.
            </p>
        </div>
    {%  endif  %}

    {%  if project.rfp.status == 'open' %}
        <div class="alert alert-link">
            <p><a href="{% url 'create_project_previous' project.pk %}">
            Click here to edit your project</a>
            </p>
        </div>
    {%  endif %}
</div>


<!--Project Details-->
{% include 'rfp/project/project_details.html' %}

<!--Project Budget-->
{% include 'rfp/project/project_budget.html' %}

{% if project.rfp.add_reviewer %}
<!--Reviewer Table-->
    {% include 'rfp/project/project_reviewer.html' %}

{% endif %}

</div>

<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">SUBMIT YOUR PROJECT</h4>
      </div>
      <div class="modal-body">

        <div class="hide" id="ajaxLoader">
            <img src="/static/images/ajax_loader.gif">
        </div>

        <div id="PreSubmitText">
             <p> You are just about to submit your project. You will still be able to edit your project until
            the deadline of the {{  project.rfp.name }} call for proposal: <strong>{{ project.rfp.deadline }}</strong>.
            </p>
             <p> Click Submit to validate your project. After successful submission, you will receive a confirmation email at: {{ project.user.email }}.</p>
        </div>

      </div>

      <div class="modal-footer">

          <form id="finalSubmit" method="post">
              <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
              <input  id="project-final-submit" class="save_btn btn btn-primary pull-right" type="submit" value="Save"  />
          </form>

      </div>

    </div>

  </div>
</div>

<script>
    $('.act-link').hide();
    var postedData = $('#finalSubmit').serialize();

    $('#project-final-submit').click(function(){
        $('#ajaxLoader').removeClass('hide');
        $('#PreSubmitText').addClass('hide');
        $('.modal-footer').hide();

        $.ajax({
            type:"post",
            url: "{% url 'create_project_summary' project.id %}'",
            data: postedData
         }).done(function(data){
            console.log(data);
        });



    })

</script>

{% endblock %}